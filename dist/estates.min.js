!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("infestines"),require("partial.lenses")):"function"==typeof define&&define.amd?define(["exports","infestines","partial.lenses"],n):n(t.E={},t.I,t.L)}(this,function(t,n,e){"use strict";function i(t){throw Error(w+t)}function r(t,n){for(var e=0;e<n.length;++e){var i=n[e];if(n[e]=null,void 0!==i)do{var r=i;i=r.link,r.link=null,t(r)}while(void 0!==i)}n.length=0}function o(t,e,i,r,u){if(ot(u)){if(t(r=i(r,e(u))))return r}else if(n.isArray(u)){for(var c=0,s=u.length;c<s;++c)if(t(r=o(t,e,i,r,u[c])))return r}else if(n.isObject(u))for(var f in u)if(t(r=o(t,e,i,r,u[f])))return r;return r}function u(t,e){if(ot(e))return t(e);if(n.isArray(e)){for(var i=e.length,r=e,o=0;o<i;++o){var c=u(t,e[o]);n.identicalU(r[o],c)||(r===e&&(r=e.slice(0)),r[o]=c)}return r}if(n.isObject(e)){var s=e;for(var f in e){var a=u(t,e[f]);n.identicalU(s[f],a)||(s===e&&(s=n.assign({},s)),s[f]=a)}return s}return e}function c(t,e,r){if(ct(t))t.collectAssignments(e,r);else if(n.isArray(t)&&n.isArray(e))for(var o=0,u=t.length;o<u;++o)c(t[o],e[o],r);else if(n.isObject(t)&&n.isObject(e))for(var s in t)c(t[s],e[s],r);else n.identicalU(ot(t)?a(t):t,e)||i("Mismatch between sources and written value.")}function s(t,e){tt(e)?t(e):n.isArray(e)&&e.forEach(t)}function f(t,n){if(it(n))return t(n);var e=new $(n);m(e);var i=t(n);return O(e),i}function a(t){var n=t.value;return n!==C?n:void 0}function l(t,n){var e=new Map;c(t,n,e),function(t){d(function(){t instanceof Map?t.forEach(b):b(t[1],t[0])})}(e)}function h(t){var n=t.sources;rt(n)&&t.next(J(n))}function v(t){L(nt,t.sources)&&z(t)}function p(t){var n=t.sinks;void 0!==n&&(t.sinks=void 0,s(v,n))}function y(t){O(t),t.sources=void 0,X(t),t.complete()}function d(t){M?i("Side-effects are only allowed in `tap` and `on*` callbacks."):(M=!0,t(),r(h,F),r(y,S),M=!1,function(){var t=q.slice(0).reverse();for(q.length=0;t.length;)t.pop()()}())}function _(t){Q(t)?null===t.link&&t.next(J(t.sources)):V(t)}function b(t,e){n.identicalU(e.value,t)||(e.value=t,s(_,e.sinks))}function k(t,n){d(function(){z(t),b(n,t)})}function g(t){R(function(n){var e=function(t,n){var e=t.sinks;return void 0===e?(t.sinks=n,1):tt(e)?(t.sinks=[e,n],2):e.push(n)}(n,t);n.isConstant()?z(n):1===e&&W(n)&&g(n)},t.sources),V(t)}function m(t){d(function(){return g(t)})}function O(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;R(function(e){var i=e.sinks;if(i===t)e.sinks=void 0,O(e,n+1);else if(void 0!==i){var r=i.lastIndexOf(t);if(-1!==r){var o=i.length-1;i[r]=i[o],1!==o?i.length=o:e.sinks=i[0]}}},t.sources)}var w="estates: ",j=function(t){return!t},x=function(t){},P=function(t){return function(n){return n instanceof t}},A=function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")},U=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),E=function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function, not "+typeof n);t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),n&&(Object.setPrototypeOf?Object.setPrototypeOf(t,n):t.__proto__=n)},T=function(t,n){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!n||"object"!=typeof n&&"function"!=typeof n?t:n},C=n.freeze([]),M=!1,F=[],S=[],q=[],I=function(t){return function(n){if(null===n.link){var e=K(n);if(t.length<e)for(;t.push(void 0)<e;);var r=t[e];null===r&&i("Bug."),n.link=r,t[e]=n}}},V=I(F),z=I(S),B=function(t){return q.push(t)},D=n.curry(function(t,n,e,i){return function(r){return o(t,n,e,i,r)}}),L=function(t,e){return o(j,t,n.sndU,!0,e)},N=function(t){return function(n){return L(t,n)}},R=function(t,e){return o(x,t,n.sndU,void 0,e)},G=function(t){return void 0!==at(t)},H=function(t){return void 0!==lt(t)},J=function(t){return u(a,t)},K=function(t){return t.info>>2},Q=function(t){return 2&t.info},W=function(t){return 1&t.info},X=function(t){return t.info&=-4},Y=D(n.always(!1))(K,Math.max,-1),Z=D(function(t){return 2===t},n.always(1),function(t,n){return t+n},0),$=function(){function t(n){A(this,t),this.sources=n,this.info=function(t){var n=Y(t)+1,e=Z(t);return n<<2|(1===e)<<1|0!==e}(n),this.link=null}return U(t,[{key:"next",value:function(t){}},{key:"complete",value:function(){p(this)}},{key:"isConstant",value:function(){return L(nt,this.sources)}}]),t}(),tt=P($),nt=function(t){return t.isConstant()},et=function(t){function n(t){A(this,n);var e=T(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t));return e.sinks=void 0,e.value=C,e}return E(n,$),n}(),it=N(function(t){return t.sinks}),rt=N(function(t){return t.value!==C}),ot=P(et),ut=function(t){function n(){return A(this,n),T(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return E(n,et),U(n,[{key:"collectAssignments",value:function(t,n){i("This method should never be called.")}}]),n}(),ct=P(ut),st=n.curry(function(t,n){return f(function(t){l(t,n)},t)}),ft=n.curry(function(t,n){return f(function(t){var e=J(t);l(t,n(e))},t)}),at=D(n.id,n.id,n.sndU,void 0),lt=D(ct,n.id,n.sndU,void 0),ht=function(t){function n(){return A(this,n),T(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return E(n,ut),U(n,[{key:"collectAssignments",value:function(t,n){n.set(this,t)}},{key:"isConstant",value:function(){return!1}},{key:"next",value:function(t){i("This method should never be called.")}},{key:"complete",value:function(){i("This method should never be called.")}}]),n}(),vt=function(t){function n(t){A(this,n);var e=T(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return e.value=t,e}return E(n,ht),n}(),pt=function(t){function n(t,e){A(this,n);var i=T(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.ms=t,i.timeout=0,i}return E(n,et),U(n,[{key:"next",value:function(t){var n=this,e=this.timeout;0!==e&&clearTimeout(e),this.timeout=setTimeout(function(){-1===n.timeout?k(n,t):(n.timeout=0,function(t,n){d(function(){return b(n,t)})}(n,t))})}},{key:"complete",value:function(){var t=this.timeout;this.timeout=-1,0===t&&p(this)}}]),n}(),yt=n.curry(function(t,n){return new pt(t,n)}),dt=function t(n){A(this,t),this.reason=n},_t=function(t){return new dt(t)},bt=P(dt),kt=function(t){function e(t){A(this,e);var i=T(this,(e.__proto__||Object.getPrototypeOf(e)).call(this)),r=function(t){k(i,t)};return t.then(r,n.pipe2U(_t,r)),i}return E(e,et),U(e,[{key:"isConstant",value:function(){return rt(this)}}]),e}(),gt=function(t){function n(t,e){A(this,n);var i=T(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.fn=t,i}return E(n,et),U(n,[{key:"next",value:function(t){b(this.fn.apply(this,function(t){if(Array.isArray(t)){for(var n=0,e=Array(t.length);n<t.length;n++)e[n]=t[n];return e}return Array.from(t)}(t)),this)}},{key:"complete",value:function(){this.fn=void 0,p(this)}}]),n}(),mt=function(t){function n(){return A(this,n),T(this,(n.__proto__||Object.getPrototypeOf(n)).apply(this,arguments))}return E(n,gt),U(n,[{key:"next",value:function(t){b(this.fn(t),this)}}]),n}(),Ot=n.curry(function(t,n){return G(n)?new mt(t,n):t(n)}),wt=function(t){function n(t,e){A(this,n);var i=T(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.effect=t,m(i),i}return E(n,$),U(n,[{key:"unsubscribe",value:function(){this.sources=this.effect=O(this)}},{key:"next",value:function(t){var n=this.effect;B(function(){return n(t,"next")})}},{key:"complete",value:function(){var t=this.effect;this.effect=void 0,B(function(){return t(void 0,"complete")})}}]),n}(),jt=n.curry(function(t,n){if(G(n))return new wt(t,n);t(n,"next"),t(void 0,"complete")}),xt=function(t){function n(t,e){A(this,n);var i=T(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.effect=t,m(i),i}return E(n,$),U(n,[{key:"unsubscribe",value:function(){this.sources=this.effect=O(this)}},{key:"next",value:function(t){var n=this.effect;B(function(){return n(t)})}},{key:"complete",value:function(){this.effect=void 0}}]),n}(),Pt=n.curry(function(t,n){if(G(n))return new xt(t,n);t(n)}),At=function(t){function n(t,e){A(this,n);var i=T(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.n=t,i}return E(n,et),U(n,[{key:"next",value:function(t){var n=this.n;0<n?this.n=n-1:b(t,this)}}]),n}(),Ut=n.curry(function(t,n){return t<=0?n:new At(t,n)}),Et=function(t){function n(t,e){A(this,n);var i=T(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.predicate=t,i}return E(n,et),U(n,[{key:"next",value:function(t){this.predicate(t)&&b(t,this)}},{key:"complete",value:function(){this.predicate=void 0,p(this)}}]),n}(),Tt=n.curry(function(t,n){return new Et(t,n)}),Ct=function(t){function n(t,e){A(this,n);var i=T(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.n=t,i}return E(n,et),U(n,[{key:"next",value:function(t){b(t,this);var n=this.n;0!==n&&0!=(this.n=n-1)||z(this)}}]),n}(),Mt=n.curry(function(t,n){return G(n)?new Ct(Math.max(0,t),n):n}),Ft=function(t){function n(t,e){A(this,n);var i=T(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.effect=t,i}return E(n,et),U(n,[{key:"next",value:function(t){var n=this.effect;b(t,this),B(function(){return n(t)})}},{key:"complete",value:function(){this.effect=void 0,p(this)}}]),n}(),St=n.curry(function(t,n){return G(n)?new Ft(t,n):(t(n),n)}),qt=function(t){function n(t,e){A(this,n);var i=T(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return i.lens=t,i}return E(n,ut),U(n,[{key:"collectAssignments",value:function(t,n){c(this.sources,e.set(this.lens,t,J(this.sources)),n)}},{key:"next",value:function(t){b(e.get(this.lens,t),this)}},{key:"complete",value:function(){this.lens=void 0,p(this)}}]),n}(),It=function(t){function n(t,e){return A(this,n),T(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,[t,e]))}return E(n,ut),U(n,[{key:"collectAssignments",value:function(t,n){c(this.sources[1],e.set(J(this.sources[0]),t,J(this.sources[1])),n)}},{key:"next",value:function(t){b(e.get(t[0],t[1]),this)}}]),n}(),Vt=n.curry(function(t,n){return G(t)?H(n)?new It(t,n):new gt(e.get,[t,n]):H(n)?new qt(t,n):G(n)?new mt(e.get(t),n):e.get(t,n)});t.atom=function(t){return new vt(t)},t.debounce=yt,t.failure=_t,t.fromPromise=function(t){return new kt(t)},t.get=function(t){return f(J,t)},t.isDetermined=rt,t.isFailure=bt,t.isSettable=H,t.isVarying=G,t.lift=function(t){var e=t.length;switch(e){case 0:return t;case 1:return function(n){return G(n)?new mt(t,n):t(n)};default:return n.arityN(e,function(){for(var n=arguments.length,e=Array(n),i=0;i<n;i++)e[i]=arguments[i];return G(e)?new gt(t,e):t.apply(void 0,e)})}},t.map=Ot,t.modify=ft,t.on=jt,t.onValue=Pt,t.reasonOf=function(t){return t.reason},t.set=st,t.skipFirst=Ut,t.skipUnless=Tt,t.takeFirst=Mt,t.tap=St,t.unsubscribe=function(t){void 0!==t&&t.unsubscribe()},t.variable=function(){return new ht},t.view=Vt,Object.defineProperty(t,"__esModule",{value:!0})});
